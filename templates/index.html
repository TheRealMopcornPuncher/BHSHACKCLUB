{% extends "layout.html" %}

{% block title %}Welcome to BHS Hack Club{% endblock %}

{% block content %}
<div class="container" style="margin-top: 20px; margin-bottom: 20px; padding: 20px; border: 1px solid #ccc; border-radius: 20px;">
    <div class="row">
        <div class="col">
            <h1>Welcome to the BHS Hack Club website!</h1>
            <p>This is the official website of the BHS Hack Club, programmed BY the BHS Hack Club! We are a group of students who are passionate about technology and programming. We meet every week to learn new things, work on projects, and have fun!</p>
            <p>Feel free to explore our website to learn more about us, our events, and the resources we offer. If you are interested in joining us, please contact us or come to one of our meetings!</p>
        </div>
    </div>
</div>

<!-- Three.js Example -->
<div id="three-container"></div>
{% endblock %}

{% block scripts %}
<script type="module">
    import * as THREE from '/static/js/three.module.js';
    import { EffectComposer } from '/static/js/postprocessing/EffectComposer.js';
    import { RenderPass } from '/static/js/postprocessing/RenderPass.js';
    import { UnrealBloomPass } from '/static/js/postprocessing/UnrealBloomPass.js';

    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 30;

    const renderer = new THREE.WebGLRenderer({ alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.physicallyCorrectLights = true; // Ensure proper lighting and bloom rendering

    // Add the renderer's canvas to the #three-container
    const threeContainer = document.getElementById('three-container');
    threeContainer.appendChild(renderer.domElement);

    // Postprocessing setup
    const composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene, camera));

    const bloomPass = new UnrealBloomPass(
        new THREE.Vector2(window.innerWidth, window.innerHeight),
        1.5, // strength
        0.4, // radius
        0.1 // threshold (lowered to make the bloom effect visible)
    );
    composer.addPass(bloomPass);

    // Geometry and Material for each mesh
    const geometry = new THREE.SphereGeometry(0.1, 8, 8); // Reduced segments for optimization
    const material = new THREE.MeshStandardMaterial({
        emissive: new THREE.Color(0x00ff00),
        emissiveIntensity: 1.5,
        metalness: 0.5,
        roughness: 0.5
    });

    // Browser detection
    const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);

    // Adjust grid size and spacing based on browser
    const gridSize = isChrome ? 30 : 50; // Reduce grid size for Chrome
    const spacing = isChrome ? 3 : 2;    // Increase spacing for Chrome

    // Create individual meshes to handle many points
    const points = [];

    for (let x = -gridSize / 2; x < gridSize / 2; x++) {
        for (let z = -gridSize / 2; z < gridSize / 2; z++) {
            const color = new THREE.Color(`hsl(${(x + z + 360) % 360}, 80%, 60%)`);
            const point = new THREE.Mesh(geometry, material);
            point.position.set(x * spacing, 0, z * spacing);
            point.material.emissive = color; // Set color for each mesh
            scene.add(point);
            points.push(point);
        }
    }

    let time = 0;
    function animate() {
        time += 0.02;

        points.forEach((point) => {
            const x = point.position.x;
            const z = point.position.z;
            point.position.y = Math.sin((x + time) * 0.5) + Math.cos((z + time) * 0.5);
        });

        // Render the scene with bloom effect
        composer.render();
        requestAnimationFrame(animate);
    }
    animate();

    // Resize handling for responsive design
    window.addEventListener('resize', () => {
        camera.aspect = threeContainer.offsetWidth / threeContainer.offsetHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(threeContainer.offsetWidth, threeContainer.offsetHeight);
        composer.setSize(threeContainer.offsetWidth, threeContainer.offsetHeight);
    });
</script>
{% endblock %}
